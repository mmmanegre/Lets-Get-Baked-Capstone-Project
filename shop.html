<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shopping List</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header>
        <div class="head">
            <img src="images/logo2.png" class="logo">

            <nav>
                <a href="index.html">Home</a>
                <a href="profile.html">Profile</a>
                <a href="savedrecipes.html">My Recipes</a>
                <a href="shop.html">Shopping List</a>
            </nav>
        </div>
    </header>

    <main>
        <h1>Your Shopping List</h1>
        <ul id="shopping-list"></ul>
    </main>

    <footer>
        <p>Created by Michelle, Kaylee, and Ellie</p>
    </footer>

    <!-- Supabase client -->
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

const supabase = createClient(
    "https://vbbxceqbzcfieymlcksu.supabase.co",
    "YOUR_PUBLIC_ANON_KEY_HERE"
);

async function loadShoppingList() {
    // 1. Get Supabase authenticated user (correct way)
    const { data: userData } = await supabase.auth.getUser();
    const user = userData?.user;

    if (!user) {
        document.getElementById("shopping-list").innerHTML =
            "<li>Please log in to see your shopping list.</li>";
        return;
    }

    // 2. Load items using user_id (matches your save script)
    const { data, error } = await supabase
        .from("shopping_list")
        .select("*")
        .eq("user_id", user.id);

    if (error) {
        console.error("Supabase error:", error);
        return;
    }

    const list = document.getElementById("shopping-list");
    list.innerHTML = "";

    if (!data || data.length === 0) {
        list.innerHTML = "<li>Your list is empty!</li>";
        return;
    }

    // 3. Render items
    data.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item.ingredient;

        // Add delete button
        const btn = document.createElement("button");
        btn.textContent = "âŒ";
        btn.style.marginLeft = "10px";
        btn.onclick = () => deleteItem(item.id);

        li.appendChild(btn);
        list.appendChild(li);
    });
}

// 4. Delete item
async function deleteItem(id) {
    const { error } = await supabase
        .from("shopping_list")
        .delete()
        .eq("id", id);

    if (error) console.error(error);

    loadShoppingList();
}

loadShoppingList();
</script>

</body>
</html>
